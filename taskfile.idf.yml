version: 3
vars:
  EXPORT_IDF_CMD: '. ../esp-export.sh'
  IDF_PATH_CMD: 'IDF_PATH="$(sh ../esp-idf-path.sh)"'
tasks:
  ensure-available:
    silent: true
    cmd: |
      cd {{.TASKFILE_DIR}}
      if ! sh ./esp-export.sh --quiet --find-only; then
        echo >&2 "esp-idf not found in all of: $IDF_PATH ~/esp/esp-idf or ./.esp-idf"

        echo >&2 "downloading esp-idf to ./.esp-idf"
        git clone \
          https://github.com/espressif/esp-idf.git \
          ./.esp-idf \
          -b v5.4 --recursive

        cd ./.esp-idf
        ./install.sh esp32
      fi
